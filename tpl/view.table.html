<?php if(!defined('BCDB')) exit; ?>

<?php if(isset($groups)): ?>
    <form action="<?php echo $CFG->wwwroot ?>/blocks/bc_dashboard/index.php?Qs=view/course/<?php echo $courseID ?>" method="post">
        <select id="filter-by-group" name="group" class="form-control" style="width:20%">
            <option value="">Filter by group...</option>
            <?php foreach($groups as $group): ?>
                <option value="<?php echo $group->id ?>" <?php echo (isset($groupID) && $groupID == $group->id) ? 'selected' : ''; ?>><?php echo $group->name ?></option>
            <?php endforeach; ?>
        </select>
    </form>
    <br>
<?php endif; ?>

<form id='mass_action_form' action='' method='post'>

    <table id='student_list' class='table table-bordered table-hover table-striped'>

        <thead>
            <tr>
                <th data-orderable="false"><input type='checkbox' id='chkall'  /></th>
                <th data-orderable="false"></th>
                <th><?php echo $string['name'] ?></th>

                <?php if ($bcdb['elbp']): ?>
                    <?php echo $this->getStudentHeaders_Attendance() ?>
                    <?php echo $this->getStudentHeaders_Tutorials() ?>
                    <?php echo $this->getStudentHeaders_Comments() ?>
                <?php endif; ?>

                <?php if ($bcdb['gradetracker']): ?>
                    <?php echo $this->getStudentHeaders_TargetGrade() ?>
                    <?php echo $this->getStudentHeaders_AspirationalGrade() ?>
                <?php endif; ?>

            </tr>
        </thead>

        <tbody>
            <?php if ($students): ?>
                <?php foreach($students as $student): ?>
                    <tr>
                        <td>
                            <input type='checkbox' class='stud_checkbox' value='<?php echo $student->id ?>' />
                        </td>
                        <td>
                            <?php echo $OUTPUT->user_picture($student, array("size"=>30)); ?>
                        </td>
                        <td>
                            <?php if ($bcdb['elbp']): ?>
                                <a href="<?php echo $CFG->wwwroot ?>/blocks/elbp/view.php?id=<?php echo $student->id ?>" target="_blank"><?php echo \fullname($student) ?></a>
                            <?php else: ?>
                                <?php echo \fullname($student) ?>
                            <?php endif; ?>
                        </td>

                        <?php if ($bcdb['elbp']): ?>
                            <?php echo $this->getStudentCells_Attendance($student->id) ?>
                            <?php echo $this->getStudentCells_Tutorials($student->id) ?>
                            <?php echo $this->getStudentCells_Comments($student->id) ?>
                        <?php endif; ?>

                        <?php if ($bcdb['gradetracker']): ?>
                            <?php echo $this->getStudentCells_TargetGrade($student->id) ?>
                            <?php echo $this->getStudentCells_AspirationalGrade($student->id) ?>
                        <?php endif; ?>


                    </tr>
                <?php endforeach; ?>
            <?php endif; ?>
        </tbody>

    </table>

    <div id='mass_action'>
        <div class='col-lg-3'>
            <select id='student_action' name='mass_action' class='form-control'>

                <option value=''><?php echo $string['selectaction'] ?></option>

                <?php if ($bcdb['elbp'] && ( $type == 'mentees' || $type == 'additionalsupport') ): ?>
                    <option value='remove'><?php echo $string['removestudents'] ?></option>
                <?php endif; ?>

                <option value='message'><?php echo $string['sendmessage'] ?></option>

                <?php if ($massActions): ?>
                    <?php foreach($massActions as $val => $text): ?>
                        <option value='<?php echo $val ?>'><?php echo $text ?></option>
                    <?php endforeach; ?>
                <?php endif; ?>

            </select>
        </div>

    </div>

</form>